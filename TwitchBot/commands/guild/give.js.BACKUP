const { Command, client } = require('discord.js-commando');
const Discord = require('discord.js');
const SQLite = require("better-sqlite3");
const sql = new SQLite('./scores.sqlite');


module.exports = class GiveCommand extends Command {
    constructor(client) {
        super(client, {
            name: 'give',
            aliases: ['g', 'gift'],
            group: 'guild',
            memberName: 'give',
            description: 'Replies with the guild leaderboard.'
        });
    }
    
    async run(message) {
        if(!message.author.id === message.guild.owner) return message.reply("You don't have the required permission to do that.");
        const user = message.mentions.users.first() || client.users.get(args[0]);
        if(!user) return message.reply("You must mention someone or give their ID.");
        const pointsToAdd = parseInt(args[1], 10);
        if(!pointsToAdd) return message.reply("You didn't tell me how many points to give...")
        let userscore = client.getScore.get(user.id, message.guild.id);
        if (!userscore) {
            userscore = { id: message.guild.id + '-' + user.id, user: user.id, guild: message.guild.id, points: 0, level: 1 }
        }
        userscore.points += pointsToAdd;
        let userLevel = Math.floor(0.1 * Math.sqrt(score.points));
        userscore.level = userLevel;
        client.setScore.run(userscore);
        return message.channel.send(user.tag + ' has received ' + pointsToAdd + ' points and now stands at ' + userscore.points + ' points.');
    }
}