const { Command, client } = require('discord.js-commando');
const Discord = require('discord.js');
const SQLite = require("better-sqlite3");
const sql = new SQLite('./scores.sqlite');


module.exports = class LeaderboardCommand extends Command {
    constructor(client) {
        super(client, {
            name: 'leaderboard',
            aliases: ['lb', 'top'],
            group: 'guild',
            memberName: 'leaderboard',
            description: 'Replies with the guild leaderboard.'
        });
    }
    
    async run(message, {client} {
        const top10 = sql.prepare("SELECT * FROM scores WHERE guild = ? ORDER BY points DESC LIMIT 10;").all(message.guild.id);
        let embed = new Discord.MessageEmbed()
        .setTitle("Leaderboard")
        .setAuthor(client.user.username, client.user.avatarURL)
        .setDescription("Our top 10 points leaders!")
        .setColor(0x00AE86);
        for(const data of top10) {
            embed.addField(client.users.get(data.user).tag, `${data.points} points (level ${data.level})`);
            return message.channel.send(embed);
        }
});